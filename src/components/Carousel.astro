---
interface Props {
	images: string[];
	id: string;
}

const { images, id } = Astro.props;
---

<div class="carousel-container" id={id}>
	<div class="carousel-wrapper">
		{
			images.map((image, index) => (
				<div
					class={`carousel-item ${index === 0 ? "active" : ""}`}
					data-index={index}
				>
					<img src={image} alt={`Screenshot ${index + 1}`} loading="lazy" />
				</div>
			))
		}
	</div>

	{
		images.length > 1 && (
			<>
				<button class="carousel-control prev" aria-label="Previous image">
					&#10094;
				</button>
				<button class="carousel-control next" aria-label="Next image">
					&#10095;
				</button>
				<div class="carousel-indicators">
					{images.map((_, index) => (
						<button
							class={`indicator ${index === 0 ? "active" : ""}`}
							data-index={index}
							aria-label={`Go to slide ${index + 1}`}
						/>
					))}
				</div>
			</>
		)
	}
</div>

<style>
	.carousel-container {
		position: relative;
		width: 100%;
		height: 480px; /* Fixed height for consistency */
		overflow: hidden;
		border-radius: var(--radius-md);
		background-color: var(--color-surface);
	}

	.carousel-wrapper {
		width: 100%;
		height: 100%;
		position: relative;
	}

	.carousel-item {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		opacity: 0;
		transition: opacity 0.5s ease-in-out;
		display: flex;
		align-items: center;
		justify-content: center;
		background-color: #000;
	}

	.carousel-item.active {
		opacity: 1;
		z-index: 1;
	}

	.carousel-item img {
		max-width: 100%;
		max-height: 100%;
		object-fit: contain;
	}

	.carousel-control {
		position: absolute;
		top: 50%;
		transform: translateY(-50%);
		background: rgba(0, 0, 0, 0.5);
		color: white;
		border: none;
		padding: var(--space-4);
		cursor: pointer;
		z-index: 10;
		font-size: 1.5rem;
		border-radius: var(--radius-sm);
		transition: background 0.3s;
	}

	.carousel-control:hover {
		background: rgba(0, 0, 0, 0.8);
	}

	.carousel-control.prev {
		left: var(--space-2);
	}

	.carousel-control.next {
		right: var(--space-2);
	}

	.carousel-indicators {
		position: absolute;
		bottom: var(--space-4);
		left: 50%;
		transform: translateX(-50%);
		display: flex;
		gap: var(--space-2);
		z-index: 10;
	}

	.indicator {
		width: 10px;
		height: 10px;
		border-radius: 50%;
		border: none;
		background: rgba(255, 255, 255, 0.5);
		cursor: pointer;
		padding: 0;
		transition: background 0.3s;
	}

	.indicator.active {
		background: white;
	}

	@media (max-width: 768px) {
		.carousel-container {
			height: 350px;
		}
	}
</style>

<script is:inline define:vars={{ id }}>
	function initCarousel(carouselId) {
		const container = document.getElementById(carouselId);
		if (!container) return;

		const items = container.querySelectorAll(".carousel-item");
		const indicators = container.querySelectorAll(".indicator");
		const prevBtn = container.querySelector(".prev");
		const nextBtn = container.querySelector(".next");
		let currentIndex = 0;

		function showSlide(index) {
			items[currentIndex].classList.remove("active");
			indicators[currentIndex]?.classList.remove("active");
			
			currentIndex = (index + items.length) % items.length;
			
			items[currentIndex].classList.add("active");
			indicators[currentIndex]?.classList.add("active");
		}

		prevBtn?.addEventListener("click", (e) => {
			e.preventDefault();
			showSlide(currentIndex - 1);
		});

		nextBtn?.addEventListener("click", (e) => {
			e.preventDefault();
			showSlide(currentIndex + 1);
		});

		indicators.forEach((indicator, index) => {
			indicator.addEventListener("click", (e) => {
				e.preventDefault();
				showSlide(index);
			});
		});
	}

	// Initialize on page load
	initCarousel(id);
</script>
